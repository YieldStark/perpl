# Contract Deployment Guide

## Complete Contract List

### Core Infrastructure (4 contracts)
1. **RoleStore** - `core/role_store.cairo`
   - Access control (ADMIN, CONTROLLER, KEEPER roles)
   - Constructor: `admin: ContractAddress`

2. **EventEmitter** - `core/event_emitter.cairo`
   - Event emission for all protocol events
   - Constructor: (none)

3. **DataStore** - `core/data_store.cairo`
   - Centralized storage for positions, market configs, collateral pools
   - Constructor: `role_store_address: ContractAddress`

4. **Oracle** - `core/oracle.cairo`
   - Pragma Oracle integration
   - Price caching and validation
   - Constructor: `pragma_address: ContractAddress, event_emitter_address: ContractAddress, max_price_age: u64`

### Handler Contracts (4 contracts)
5. **PositionHandler** - `handlers/position_handler.cairo`
   - Open/close positions
   - ZK proof verification
   - Collateral management
   - Constructor: `data_store_address, event_emitter_address, oracle_address, verifier_address, yusd_token_address`

6. **OrderHandler** - `handlers/order_handler.cairo`
   - Market and limit orders
   - Trigger price validation
   - Constructor: `data_store_address, event_emitter_address, oracle_address`

7. **LiquidationHandler** - `handlers/liquidation_handler.cairo`
   - Position liquidations
   - Liquidator rewards
   - Constructor: `data_store_address, event_emitter_address, oracle_address, verifier_address, yusd_token_address`

8. **FeeHandler** - `handlers/fee_handler.cairo`
   - Fee collection
   - Constructor: `data_store_address, event_emitter_address`

### Router (1 contract)
9. **PerpRouter** - `router/perp_router.cairo`
   - Main entry point for all operations
   - Routes to appropriate handlers
   - Constructor: `position_handler_address, order_handler_address, liquidation_handler_address`

### Verifier (1 contract - Generated)
10. **Verifier** - Generated by Garaga from Noir circuit
    - ZK proof verification
    - Constructor: (from Garaga)

## Total: 10 Deployed Contracts

## Library Modules (Not Deployed)

- `position/` - Position utilities (position_utils, increase_position_utils, decrease_position_utils)
- `order/` - Order utilities (order_utils, base_order_utils)
- `fee/` - Fee utilities (fee_utils)
- `liquidation/` - Liquidation utilities (liquidation_utils)
- `pricing/` - Pricing utilities (pricing_utils, pnl_utils)
- `utils/` - General utilities (calc, precision, i256)

## Deployment Script Structure

```typescript
// 1. Deploy RoleStore
const roleStore = await deployRoleStore(admin);

// 2. Deploy EventEmitter
const eventEmitter = await deployEventEmitter();

// 3. Deploy DataStore
const dataStore = await deployDataStore(roleStore.address);

// 4. Deploy Oracle
const oracle = await deployOracle(
    PRAGMA_ADDRESS,
    eventEmitter.address,
    60 // max_price_age (seconds)
);

// 5. Generate & Deploy Verifier (from Noir circuit)
const verifier = await deployVerifier(); // Generated by Garaga

// 6. Deploy PositionHandler
const positionHandler = await deployPositionHandler(
    dataStore.address,
    eventEmitter.address,
    oracle.address,
    verifier.address,
    YUSD_TOKEN_ADDRESS
);

// 7. Deploy OrderHandler
const orderHandler = await deployOrderHandler(
    dataStore.address,
    eventEmitter.address,
    oracle.address
);

// 8. Deploy LiquidationHandler
const liquidationHandler = await deployLiquidationHandler(
    dataStore.address,
    eventEmitter.address,
    oracle.address,
    verifier.address,
    YUSD_TOKEN_ADDRESS
);

// 9. Deploy FeeHandler
const feeHandler = await deployFeeHandler(
    dataStore.address,
    eventEmitter.address
);

// 10. Deploy PerpRouter
const perpRouter = await deployPerpRouter(
    positionHandler.address,
    orderHandler.address,
    liquidationHandler.address
);

// 11. Initialize markets
await initializeMarkets(dataStore, oracle);
```

## Next Steps

1. Build contracts: `cd contracts && scarb build`
2. Generate verifier from Noir circuit
3. Create deployment scripts
4. Test on Ztarknet testnet








